// Generated by CoffeeScript 1.6.3
(function() {
  jQuery(function() {
    var error_func, update_status;
    error_func = function(response, a, b) {
      if (response.status === 403) {
        if (response.responseJSON.data.message === "User must be a volunteer") {
          $('#content').prepend('<div class="alert alert-error"><button type="button" class="close" data-dismiss="alert">&times;</button>User must be a volunteer.</div>');
        } else {
          window.location = "/login?next=" + window.location;
        }
      }
      return void 0;
    };
    update_status = function(status) {
      var field;
      field = $('#user-status');
      if (field) {
        field.html(status).removeClass();
        if (status === "User-created event" || status === "Confirmed") {
          field.addClass('text-success');
        } else if (status === "Unconfirmed") {
          field.addClass('text-warning');
        }
      }
      return void 0;
    };
    $('.button-div').on('click', '.commit-active', function() {
      var button, id, response;
      button = $(this);
      if (!button.hasClass('disabled')) {
        id = button.data('id');
        response = $.ajax('/ajax/main/do_event.json', {
          data: {
            'id': id
          },
          success: function(data) {
            button.removeClass('btn-primary').addClass('btn-success commit-disabled disabled').html('Participating');
            return update_status(data.data.user_status);
          },
          error: error_func,
          timeout: 3000,
          type: "POST"
        });
      }
      return void 0;
    });
    $('.button-div').on('mouseenter', '.commit-disabled', function() {
      $(this).removeClass('disabled btn-success').addClass('btn-danger').html('Remove');
      return void 0;
    });
    $('.button-div').on('mouseleave', '.commit-disabled', function() {
      $(this).removeClass('btn-danger').addClass('disabled btn-success').html('Participating');
      return void 0;
    });
    $('.button-div').on('click', '.commit-disabled', function() {
      var button, id, response;
      button = $(this);
      id = button.data('id');
      response = $.ajax('/ajax/main/dont_do_event.json', {
        data: {
          'id': id
        },
        success: function(data) {
          button.removeClass('btn-danger btn-success disabled commit-disabled').addClass('btn-primary commit-active').html('Do this event!');
          return update_status(data.data.user_status);
        },
        error: error_func,
        timeout: 3000,
        type: "POST"
      });
      return void 0;
    });
    return void 0;
  });

}).call(this);
